# Synthetic Jet DRL Control System

基于深度强化学习的合成射流控制系统。

## 项目结构

```
.
├── run/                    # 主要代码目录
│   ├── Env/               # 强化学习环境定义
│   ├── tools/             # 工具函数
│   ├── deploy/            # 部署相关代码
│   └── main.py            # 主程序入口
├── test/                  # 测试代码
└── paperwork/             # 文档
```

## 主要功能

- 基于SAC算法的强化学习控制
- 支持电压和频率控制
- 包含瞬态和稳态控制
- 实时数据采集和处理

## 环境要求

- Python 3.8+
- PyTorch
- Stable-Baselines3
- Gym

## 使用方法

1. 训练模式：

```python
run = 'train'
```

2. 继续训练模式：

```python
run = 'train_load'
```

3. 评估模式：

```python
run = 'eval'
```

## 许可证

MIT License

# 合成射流控制代码更新日志

## 2025-06-15 更新：提前控制机制实现

### 主要更改

1. 添加提前控制机制

   - 引入 `control_delay = 30`秒的控制延迟
   - 添加 `next_action`变量存储下一个step的动作
   - 实现动作的提前应用机制
2. 预测机制改进

   - 风速预测：使用二次多项式拟合
   - 振动预测：使用线性回归模型
   - 基于历史数据建立预测模型
3. 状态空间优化

   - 简化状态空间结构
   - 保留RMS值和时程数据
   - 优化数据存储格式
4. 奖励函数调整

   - 加入预测性奖励
   - 优化控制效果评估

### 技术细节

- 每个step时间间隔：14.3秒
- 控制延迟时间：30秒
- 预测窗口：使用最近10个数据点
- 数据存储路径：save/datalog/

## 2025-06-16 更新：预测模型升级与奖励函数优化

### 预测模型升级

1. 风速预测模型选择

   - 采用随机森林回归器（RandomForestRegressor）
   - 决策理由：
     * 适合处理非线性关系
     * 对异常值不敏感
     * 训练速度快，不容易过拟合
     * 可以处理高维特征
     * 适合处理风速这种相对简单的时序数据
2. 振动预测模型选择

   - 采用LSTM神经网络
   - 决策理由：
     * 特别适合处理时序数据
     * 可以捕捉长期依赖关系
     * 振动数据具有复杂的时序特征
     * 可以学习到振动与风速之间的非线性关系
     * 适合处理振动这种复杂的动态系统

### 奖励函数重构

1. 移除节能考虑

   - 决策理由：优先确保振动抑制效果
   - 实现方式：完全移除与电压相关的惩罚项
2. 新的奖励函数组成

   ```python
   总奖励 = 振动抑制奖励 + 预测性奖励 + 预测准确性奖励
   ```

   - 振动抑制奖励：

     * 使用指数衰减函数：100 * exp(-5 * rms_value)
     * 振动低于阈值(0.4)时额外奖励50分
     * 决策理由：对振动抑制效果更敏感，鼓励将振动控制在较低水平
   - 预测性奖励：

     * 权重从0.5增加到1.0
     * 决策理由：更强调提前预测和控制的重要性
   - 预测准确性奖励：

     * 权重从10.0增加到20.0
     * 决策理由：提高预测模型的准确性

### 控制延迟实现优化

1. 动作缓冲区机制

   - 使用 `action_buffer`存储未来动作
   - 根据step时间(14.3秒)和延迟时间(30秒)计算需要提前的step数
   - 决策理由：更精确地实现30秒的控制延迟
2. 预测时间窗口

   - 使用最近10个数据点进行预测
   - 决策理由：平衡预测准确性和计算效率

### 数据记录改进

1. 详细记录各个奖励组成部分
   - 振动抑制奖励
   - 预测性奖励
   - 预测准确性奖励
   - 决策理由：便于后续分析和调试

### 待优化项

1. 预测模型参数调优

   - 随机森林的树深度和数量
   - LSTM的层数和神经元数量
   - 需要根据实际数据特征进行优化
2. 奖励函数权重调整

   - 可能需要根据实际控制效果调整各项奖励的权重
   - 考虑添加自适应权重机制
3. 控制延迟验证

   - 需要验证30秒延迟的具体效果
   - 可能需要根据实际响应时间调整延迟时间

### 注意事项

- 确保数据采集的稳定性
- 监控预测模型的准确性
- 定期评估控制效果
- 记录模型训练和预测的详细日志
